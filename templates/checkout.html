<!DOCTYPE html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Checkout - Educational and Online Course HTML Website Template</title>
    <link rel="icon" href="{{ asset('img/pane_logo.png') }}" type="image/png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{{ asset('css/bootstrap.min.css') }}" />
    <!-- animate CSS -->
    <link rel="stylesheet" href="{{ asset('css/animate.css') }}" />
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="{{ asset('vendors/elegant_Icon/elegent_icon.css') }}" />
    <!-- nice select CSS -->
    <link rel="stylesheet" href="{{ asset('vendors/niceselect/css/nice-select.css') }}" />
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="{{ asset('vendors/owl_carousel/css/owl.carousel.css') }}" />
    <!-- magnific popup CSS -->
    <link rel="stylesheet" href="{{ asset('vendors/magnify_popup/magnific-popup.css') }}" />
    <!-- Countdown CSS -->
    <link rel="stylesheet" href="{{ asset('vendors/countdown/css/Countdown.css') }}" />
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="{{ asset('css/flaticon.css') }}" />
    <!-- aos CSS -->
    <link rel="stylesheet" href="{{ asset('vendors/aos/aos.css') }}" />
    <!-- course CSS -->
    <link rel="stylesheet" href="{{ asset('css/courses.css') }}" />
    <!-- style CSS -->
    <link rel="stylesheet" href="{{ asset('style.css') }}" />
    <style>
        #promo-code {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }

        #promo-code h4 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #333;
        }

        .promo-code-field {
            display: flex;
            align-items: center;
        }

        #promo-code-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        #apply-promo-code {
            padding: 10px 20px;
            background-color: #EFC078;
            color: #1A1B25;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #apply-promo-code:hover {
            background-color: #FDD6A0;
        }

        .promo-code-message {
            margin-top: 10px;
            font-size: 14px;
            color: #888;
        }
        #stripe-submit-button{
            display: none;
        }
        .order-summary {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin-bottom: 20px;
        }

        .order-summary .summary-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        .order-summary table {
            width: 100%;
        }

        .order-summary th,
        .order-summary td {
            padding: 10px;
            text-align: left;
        }

        .order-summary .item-name {
            font-weight: bold;
            color: #333;
        }

        .order-summary .item-price,
        .order-summary .total-price {
            font-weight: bold;
            color: #333;
        }

        .order-summary tfoot th {
            text-align: right;
        }

        .order-summary tfoot td {
            font-size: 18px;
            color: #333;
            padding-top: 10px;
        }

        .debit-card-info {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            font-size: 40px;
            color: #333;
        }

        .debit-card-info.show {
            display: block;
        }

        .debit-card-info label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .debit-card-info input[type="text"],
        .debit-card-info input[type="number"],
        .debit-card-info input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 18px;
        }

        .debit-card-info button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .debit-card-info button:hover {
            background-color: #555;
        }
        #card-element {
            background-color: transparent;
            border: 1.5px solid #EFC078;
            border-radius: 8px;
        }

        #stripe-submit-button {
            background-color: #EFC078;
            color: #1A1B25;
            font-family: Sohne, system-ui, sans-serif;
            font-weight: 500;
            border-radius: 8px;
            padding: 12px 24px;
        }

        #stripe-submit-button:hover {
            background-color: #FDD6A0;
            cursor: pointer;
        }


    </style>

</head>

<body>

{% include 'header.html' %}

<!-- breadcrumb part -->
<section class="breadcrumb_part blog_grid_bg">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 ">
                <div class="breadcrumb_iner">
                    <h2>Checkout</h2>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- breadcrumb part end -->

<!-- checkout part here -->
<div id="content" class="site-content section_padding" bis_skin_checked="1">
    <div class="lp-archive-courses" bis_skin_checked="1">
        <div id="learn-press-checkout" class="lp-content-wrap" bis_skin_checked="1">
            <h2>Checkout</h2>
            <div class="learnpress" bis_skin_checked="1">
                <form method="post" action="{{ path('app_charge') }}" id="learn-press-checkout-form" name="learn-press-checkout-form" class="lp-checkout-form" tabindex="0" enctype="multipart/form-data">
                    <div class="lp-checkout-form__before" bis_skin_checked="1">
                        <input type="hidden" name="amount" value="{{ pricing.price }}">

                        <div id="checkout-order" class="lp-checkout-block right" bis_skin_checked="1">
                            <div class="lp-checkout-order__inner" bis_skin_checked="1">
                                <div class="order-summary">
                                    <h2 class="summary-title">Order Summary</h2>
                                    <table>
                                        <tbody>
                                        <tr>
                                            <td class="item-name">{{ pricing.name }}</td>
                                            <input type="hidden" name="pricing_name" value="{{ pricing.name }}">
                                            <td class="item-price">{{ pricing.price }}€</td>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th>Total</th>
                                            <td class="total-price" id="total-price">{{ pricing.price }}€</td>
                                        </tr>
                                        </tfoot>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="lp-checkout-form__after" bis_skin_checked="1">
                        <div id="checkout-payment" class="lp-checkout-block left" bis_skin_checked="1">
                            <h4>Payment<span class="secure-connection">
                                    <i class="fas fa-lock"></i>Secure Connection</span>
                            </h4>
                            <ul class="payment-methods">
                                <li id="learn-press-payment-method-paypal" class="lp-payment-method lp-payment-method-paypal selected">
                                    <label for="payment_method_paypal">
                                        <input type="radio" class="gateway-input" name="payment_method" id="payment_method_paypal" value="paypal" checked="checked" data-order_button_text="" onclick="showPayPalButton()">
                                        <img class="gateway-icon" src="{{ asset('img/paypal-logo-preview.png') }}" alt="PayPal" style="">
                                    </label>
                                </li>

                                <li id="learn-press-payment-method-debit-card" class="lp-payment-method lp-payment-method-debit-card">
                                    <label for="payment_method_debit_card">
                                        <input type="radio" class="gateway-input" name="payment_method" id="payment_method_debit_card" value="debit_card" data-order_button_text="" onclick="showDebitCardButton()">
                                        <img class="gateway-icon" src="{{ asset('img/debit_card.png') }}" alt="Debit Card" style="">
                                    </label>
                                </li>
                            </ul>

                        </div>
                        <div id="promo-code" class="lp-promo-code" bis_skin_checked="1">
                            <h4>Promo Code</h4>
                            <div class="promo-code-field">
                                <input type="text" id="promo-code-input" name="promo_code" placeholder="Enter promo code">
                                <button type="button" id="apply-promo-code">Apply</button>
                            </div>
                            <p id="promo-code-message" class="promo-code-message"></p>
                        </div>
                        <div id="card-element" class="debit-card-info">
                        </div>

                        <input type="hidden" name="stripeToken" id="stripeToken" value="">
                        <input type="hidden" name="amount" id="amount" value="{{ pricing.price * 100 }}">

                        <div id="card-errors" role="alert"></div>
                        <button type="button" class="lp-button button alt" id="stripe-submit-button">Place order</button>
                        <div id="paypal-button-container"></div>

                        <p class="lp-terms-and-conditions">
                            By completing your purchase you agree to those <a href="#" target="_blank" bis_skin_checked="1">Terms &amp; Conditions</a>.
                        </p>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
<!-- checkout part end -->


<!-- footer part here -->
<footer class="footer_section">
    {% include 'footer.html' %}
</footer>
<script src="https://js.stripe.com/v3/"></script>
<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=EUR&disable-funding=credit,card"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const applyPromoCodeButton = document.getElementById("apply-promo-code");
        const promoCodeInput = document.getElementById("promo-code-input");
        const promoCodeMessage = document.getElementById("promo-code-message");
        const originalPrice = parseFloat("{{ pricing.price }}");
        let currentPrice = originalPrice; // Initialize with the original price

        applyPromoCodeButton.addEventListener("click", function () {
            const enteredPromoCode = promoCodeInput.value.trim();

            // Send an AJAX request to fetch the discount percentage
            fetch(`/get-promo-code-discount/${enteredPromoCode}`)
                .then(response => response.json())
                .then(data => {
                    if (data.discount !== null) {
                        const discountPercentage = data.discount;
                        const discountedAmount = originalPrice * (discountPercentage / 100);
                        currentPrice = originalPrice - discountedAmount; // Update the current price
                        document.getElementById("amount").value = currentPrice * 100; // Convert to cents
                        // Update the displayed prices in the table
                        const itemPriceCell = document.querySelector(".item-price");
                        const totalPriceCell = document.getElementById("total-price");
                        itemPriceCell.textContent = `${currentPrice.toFixed(2)}€`; // Update item price
                        totalPriceCell.textContent = `${currentPrice.toFixed(2)}€`; // Update total price

                        promoCodeMessage.textContent = `Promo code applied: ${discountPercentage}% discount`;
                    } else {
                        promoCodeMessage.textContent = "Invalid promo code!";
                    }
                })
                .catch(error => {
                    console.error("Error fetching discount:", error);
                    promoCodeMessage.textContent = "Invalid promo code!";
                });
        });

    });
    function showPayPalButton() {
        var debitCardInfo = document.querySelector('.debit-card-info');
        var placeOrderButton = document.getElementById('stripe-submit-button');
        var payPalButtonContainer = document.getElementById('paypal-button-container');

        if (debitCardInfo) {
            debitCardInfo.style.display = 'none';
        }
        if (placeOrderButton) {
            placeOrderButton.style.display = 'none';
        }
        if (payPalButtonContainer) {
            payPalButtonContainer.style.display = 'block';
        }
    }

    function showDebitCardButton() {
        var debitCardInfo = document.querySelector('.debit-card-info');
        var placeOrderButton = document.getElementById('stripe-submit-button');
        var payPalButtonContainer = document.getElementById('paypal-button-container');

        if (debitCardInfo) {
            debitCardInfo.style.display = 'block';
        }
        if (placeOrderButton) {
            placeOrderButton.style.display = 'block';
        }
        if (payPalButtonContainer) {
            payPalButtonContainer.style.display = 'none';
        }
    }
    document.addEventListener("DOMContentLoaded", function() {
        const stripe = Stripe("{{ stripe_key }}");
        const appearance = {
            theme: 'night',
            labels: 'floating'
        };

        const elements = stripe.elements({appearance});
        const cardElement = elements.create("card", { hidePostalCode: true, style: {
                base: {
                    iconColor: '#c4f0ff',
                    color: '#333',
                    fontWeight: '800',
                    fontFamily: 'Roboto, Open Sans, Segoe UI, sans-serif',
                    fontSize: '18px',
                    fontSmoothing: 'antialiased',
                    ':-webkit-autofill': {
                        color: '#fce883',
                    },
                    '::placeholder': {
                        color: '#87BBFD',
                    },
                },
                invalid: {
                    iconColor: '#FFC7EE',
                    color: '#FFC7EE',
                },
            }});
        cardElement.mount("#card-element");

        const stripeSubmitButton = document.getElementById("stripe-submit-button");
        stripeSubmitButton.addEventListener("click", handleStripeSubmit);

        async function handleStripeSubmit() {
            try {
                const { token, error } = await stripe.createToken(cardElement);
                handleTokenResult(token, error);
            } catch (error) {
                console.error("Error creating token:", error);
            }
        }

        function handleTokenResult(token, error) {
            if (error) {
                // Display error message if token creation fails
                const errorElement = document.getElementById("card-errors");
                errorElement.textContent = error.message;
            } else {
                // Set the token value and submit the form
                document.getElementById("stripeToken").value = token.id;
                document.getElementById("learn-press-checkout-form").submit();
            }
        }
    });

    paypal.Buttons({
        createOrder: function (data, actions) {
            // Set up the transaction
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        currency_code: 'EUR',
                        value: '{{ pricing.price }}'
                    }
                }]
            });
        },
        fundingSource: paypal.FUNDING.PAYPAL, // Only show PayPal login option
        onApprove: function (data, actions) {
            // Capture the funds from the transaction
            return actions.order.capture().then(function (details) {
                // Send the details to your server for further processing
                document.getElementById('learn-press-checkout-form').submit();
            });
        }
    }).render('#paypal-button-container');


</script>

<!-- jquery slim -->
<script src="{{ asset('js/jquery-3.4.1.min.js') }}"></script>
<!-- popper js -->
<script src="{{ asset('js/popper.min.js') }}"></script>
<!-- bootstrap js -->
<script src="{{ asset('js/bootstrap.min.js') }}"></script>
<!-- nice select -->
<script src="{{ asset('vendors/niceselect/js/jquery.nice-select.min.js') }}"></script>
<!-- owl carousel js -->
<script src="{{ asset('vendors/owl_carousel/js/owl.carousel.min.js') }}"></script>
<!-- magnify popup js -->
<script src="{{ asset('vendors/magnify_popup/jquery.magnific-popup.js') }}"></script>
<!-- simplyCountdown js -->
<script src="{{ asset('vendors/countdown/js/simplyCountdown.min.js') }}"></script>
<!-- counter js -->
<script src="{{ asset('vendors/counter/jquery.countTo.js') }}"></script>
<!-- aos js -->
<script src="{{ asset('vendors/aos/aos.js') }}"></script>
<!-- font awesome js -->
<script src="https://kit.fontawesome.com/6ee3230338.js"></script>
<!-- custom js -->
<script src="{{ asset('js/custom.js') }}"></script>

</body>

</html>
